---
info:
  title: Mihari API
  version: 0.0.1
swagger: "2.0"
produces:
  - application/json
tags:
  - name: alerts
    description: Operations about alerts
  - name: artifacts
    description: Operations about artifacts
  - name: configs
    description: Operations about configs
  - name: ip_addresses
    description: Operations about ip_addresses
  - name: rules
    description: Operations about rules
  - name: tags
    description: Operations about tags
paths:
  "/api/alerts":
    post:
      summary: Create an alert
      description: Create an alert
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: postApiAlerts
          in: body
          required: true
          schema:
            "$ref": "#/definitions/postApiAlerts"
      responses:
        "201":
          description: Create an alert
          schema:
            "$ref": "#/definitions/Mihari_Entities_Alert"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - alerts
    get:
      summary: List/search alerts
      description: List/search alerts
      produces:
        - application/json
      parameters:
        - in: query
          name: q
          type: string
          default: ""
          required: false
        - in: query
          name: page
          type: integer
          format: int32
          default: 1
          required: false
        - in: query
          name: limit
          type: integer
          format: int32
          default: 10
          required: false
      responses:
        "200":
          description: List/search alerts
          schema:
            type: array
            items:
              "$ref": "#/definitions/Mihari_Entities_AlertsWithPagination"
      tags:
        - alerts
  "/api/alerts/{id}":
    delete:
      summary: Delete an alert
      description: Delete an alert
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "204":
          description: Delete an alert
          schema:
            "$ref": "#/definitions/Mihari_Entities_Message"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - alerts
    get:
      summary: Get an alert
      description: Get an alert
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "200":
          description: Get an alert
          schema:
            "$ref": "#/definitions/Mihari_Entities_Alert"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - alerts
  "/api/artifacts/{id}":
    delete:
      summary: Delete an artifact
      description: Delete an artifact
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "204":
          description: Delete an artifact
          schema:
            "$ref": "#/definitions/Mihari_Entities_Message"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - artifacts
    get:
      summary: Get an artifact
      description: Get an artifact
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "200":
          description: Get an artifact
          schema:
            "$ref": "#/definitions/Mihari_Entities_Artifact"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - artifacts
  "/api/artifacts/{id}/enrich":
    post:
      summary: Enrich an artifact
      description: Enrich an artifact
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "201":
          description: Enrich an artifact
          schema:
            "$ref": "#/definitions/Mihari_Entities_Message"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - artifacts
  "/api/artifacts":
    get:
      summary: List/search artifacts
      description: List/search artifacts
      produces:
        - application/json
      parameters:
        - in: query
          name: q
          type: string
          default: ""
          required: false
        - in: query
          name: page
          type: integer
          format: int32
          default: 1
          required: false
        - in: query
          name: limit
          type: integer
          format: int32
          default: 10
          required: false
      responses:
        "200":
          description: List/search artifacts
          schema:
            type: array
            items:
              "$ref": "#/definitions/Mihari_Entities_ArtifactsWithPagination"
      tags:
        - artifacts
  "/api/configs":
    get:
      summary: List configs
      description: list configs
      produces:
        - application/json
      responses:
        "200":
          description: list configs
          schema:
            type: array
            items:
              "$ref": "#/definitions/Mihari_Entities_Config"
      tags:
        - configs
  "/api/ip_addresses/{ip}":
    get:
      summary: Get an IP address
      description: Get an IP address
      produces:
        - application/json
      parameters:
        - in: path
          name: ip
          type: string
          required: true
      responses:
        "200":
          description: Get an IP address
          schema:
            "$ref": "#/definitions/Mihari_Entities_IPAddress"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - ip_addresses
  "/api/rules/{id}":
    delete:
      summary: Delete a rule
      description: Delete a rule
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: string
          required: true
      responses:
        "204":
          description: Delete a rule
          schema:
            "$ref": "#/definitions/Mihari_Entities_Message"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - rules
    get:
      summary: Get a rule
      description: Get a rule
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: string
          required: true
      responses:
        "200":
          description: Get a rule
          schema:
            "$ref": "#/definitions/Mihari_Entities_Rule"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - rules
  "/api/rules":
    put:
      summary: Update a rule
      description: Update a rule
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: putApiRules
          in: body
          required: true
          schema:
            "$ref": "#/definitions/putApiRules"
      responses:
        "201":
          description: Update a rule
          schema:
            "$ref": "#/definitions/Mihari_Entities_Rule"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - rules
    post:
      summary: Create a rule
      description: Create a rule
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - name: postApiRules
          in: body
          required: true
          schema:
            "$ref": "#/definitions/postApiRules"
      responses:
        "201":
          description: Create a rule
          schema:
            "$ref": "#/definitions/Mihari_Entities_Rule"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - rules
    get:
      summary: List/search rules
      description: List/search rules
      produces:
        - application/json
      parameters:
        - in: query
          name: q
          type: string
          default: ""
          required: false
        - in: query
          name: page
          type: integer
          format: int32
          default: 1
          required: false
        - in: query
          name: limit
          type: integer
          format: int32
          default: 10
          required: false
      responses:
        "200":
          description: List/search rules
          schema:
            type: array
            items:
              "$ref": "#/definitions/Mihari_Entities_RulesWithPagination"
      tags:
        - rules
  "/api/rules/{id}/search":
    post:
      summary: Run a rule
      description: Search by a rule
      produces:
        - application/json
      consumes:
        - application/json
      parameters:
        - in: path
          name: id
          type: string
          required: true
      responses:
        "201":
          description: Search by a rule
          schema:
            "$ref": "#/definitions/Mihari_Entities_QueueMessage"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - rules
  "/api/tags/{id}":
    delete:
      summary: Delete a tag
      description: Delete a tag
      produces:
        - application/json
      parameters:
        - in: path
          name: id
          type: integer
          format: int32
          required: true
      responses:
        "204":
          description: Delete a tag
          schema:
            "$ref": "#/definitions/Mihari_Entities_Message"
        "404":
          description: ""
          schema:
            "$ref": "#/definitions/Mihari_Entities_ErrorMessage"
      tags:
        - tags
  "/api/tags":
    get:
      summary: List tags
      description: List tags
      produces:
        - application/json
      parameters:
        - in: query
          name: q
          type: string
          default: ""
          required: false
        - in: query
          name: page
          type: integer
          format: int32
          default: 1
          required: false
        - in: query
          name: limit
          type: integer
          format: int32
          default: 10
          required: false
      responses:
        "200":
          description: List tags
          schema:
            type: array
            items:
              "$ref": "#/definitions/Mihari_Entities_TagsWithPagination"
      tags:
        - tags
definitions:
  postApiAlerts:
    type: object
    properties:
      ruleId:
        type: string
      artifacts:
        type: array
        items:
          type: string
    required:
      - ruleId
      - artifacts
    description: Create an alert
  Mihari_Entities_Alert:
    type: object
    properties:
      id:
        type: integer
        format: int32
      ruleId:
        type: string
      createdAt:
        type: string
        format: date-time
      artifacts:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_BaseArtifact"
      tags:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Tag"
    required:
      - id
      - ruleId
      - createdAt
      - tags
    description: Mihari_Entities_Alert model
  Mihari_Entities_BaseArtifact:
    type: object
    properties:
      id:
        type: integer
        format: int32
      data:
        type: string
      dataType:
        type: string
      source:
        type: string
      query:
        type: string
      metadata:
        type: object
      createdAt:
        type: string
        format: date-time
    required:
      - id
      - data
      - dataType
      - source
      - createdAt
  Mihari_Entities_Tag:
    type: object
    properties:
      id:
        type: integer
        format: int32
      name:
        type: string
    required:
      - id
      - name
  Mihari_Entities_ErrorMessage:
    type: object
    properties:
      message:
        type: string
      detail:
        type: object
    required:
      - message
    description: Mihari_Entities_ErrorMessage model
  Mihari_Entities_Message:
    type: object
    properties:
      message:
        type: string
    required:
      - message
    description: Mihari_Entities_Message model
  Mihari_Entities_AlertsWithPagination:
    type: object
    properties:
      total:
        type: integer
        format: int32
      currentPage:
        type: integer
        format: int32
      pageSize:
        type: integer
        format: int32
      results:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Alert"
    required:
      - total
      - currentPage
      - pageSize
      - results
    description: Mihari_Entities_AlertsWithPagination model
  Mihari_Entities_Artifact:
    type: object
    properties:
      id:
        type: integer
        format: int32
      data:
        type: string
      dataType:
        type: string
      source:
        type: string
      query:
        type: string
      metadata:
        type: object
      createdAt:
        type: string
        format: date-time
      tags:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Tag"
      autonomousSystem:
        "$ref": "#/definitions/Mihari_Entities_AutonomousSystem"
      geolocation:
        "$ref": "#/definitions/Mihari_Entities_Geolocation"
      whoisRecord:
        "$ref": "#/definitions/Mihari_Entities_WhoisRecord"
      reverseDnsNames:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_ReverseDnsName"
      dnsRecords:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_DnsRecord"
      cpes:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_CPE"
      ports:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Port"
    required:
      - id
      - data
      - dataType
      - source
      - createdAt
      - tags
    description: Mihari_Entities_Artifact model
  Mihari_Entities_AutonomousSystem:
    type: object
    properties:
      asn:
        type: integer
        format: int32
    required:
      - asn
  Mihari_Entities_Geolocation:
    type: object
    properties:
      country:
        type: string
      countryCode:
        type: string
      createdAt:
        type: string
        format: date-time
    required:
      - country
      - countryCode
      - createdAt
  Mihari_Entities_WhoisRecord:
    type: object
    properties:
      domain:
        type: string
      createdOn:
        type: string
        format: date
      updatedOn:
        type: string
        format: date
      expiresOn:
        type: string
        format: date
      registrar:
        type: object
      contacts:
        type: array
        items:
          type: object
      createdAt:
        type: string
        format: date-time
    required:
      - domain
      - contacts
      - createdAt
  Mihari_Entities_ReverseDnsName:
    type: object
    properties:
      name:
        type: string
      createdAt:
        type: string
        format: date-time
    required:
      - name
      - createdAt
  Mihari_Entities_DnsRecord:
    type: object
    properties:
      resource:
        type: string
      value:
        type: string
      createdAt:
        type: string
        format: date-time
    required:
      - resource
      - value
      - createdAt
  Mihari_Entities_CPE:
    type: object
    properties:
      cpe:
        type: string
      createdAt:
        type: string
        format: date-time
    required:
      - cpe
      - createdAt
  Mihari_Entities_Port:
    type: object
    properties:
      port:
        type: integer
        format: int32
      createdAt:
        type: string
        format: date-time
    required:
      - port
      - createdAt
  Mihari_Entities_ArtifactsWithPagination:
    type: object
    properties:
      total:
        type: integer
        format: int32
      currentPage:
        type: integer
        format: int32
      pageSize:
        type: integer
        format: int32
      results:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_BaseArtifact"
    required:
      - total
      - currentPage
      - pageSize
      - results
    description: Mihari_Entities_ArtifactsWithPagination model
  Mihari_Entities_Config:
    type: object
    properties:
      name:
        type: string
      type:
        type: string
      items:
        type: array
        items:
          type: object
      configured:
        type: boolean
    required:
      - name
      - type
      - items
      - configured
    description: Mihari_Entities_Config model
  Mihari_Entities_IPAddress:
    type: object
    properties:
      countryCode:
        type: string
      asn:
        type: integer
        format: int32
      loc:
        type: string
    required:
      - countryCode
    description: Mihari_Entities_IPAddress model
  putApiRules:
    type: object
    properties:
      id:
        type: string
      yaml:
        type: string
    required:
      - id
      - yaml
    description: Update a rule
  Mihari_Entities_Rule:
    type: object
    properties:
      id:
        type: string
      title:
        type: string
      description:
        type: string
      yaml:
        type: string
      createdAt:
        type: string
        format: date-time
      updatedAt:
        type: string
        format: date-time
      tags:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Tag"
    required:
      - id
      - title
      - description
      - yaml
      - createdAt
      - updatedAt
      - tags
    description: Mihari_Entities_Rule model
  postApiRules:
    type: object
    properties:
      yaml:
        type: string
    required:
      - yaml
    description: Create a rule
  Mihari_Entities_QueueMessage:
    type: object
    properties:
      message:
        type: string
      queued:
        type: boolean
    required:
      - message
      - queued
    description: Mihari_Entities_QueueMessage model
  Mihari_Entities_RulesWithPagination:
    type: object
    properties:
      total:
        type: integer
        format: int32
      currentPage:
        type: integer
        format: int32
      pageSize:
        type: integer
        format: int32
      results:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Rule"
    required:
      - total
      - currentPage
      - pageSize
      - results
    description: Mihari_Entities_RulesWithPagination model
  Mihari_Entities_TagsWithPagination:
    type: object
    properties:
      total:
        type: integer
        format: int32
      currentPage:
        type: integer
        format: int32
      pageSize:
        type: integer
        format: int32
      results:
        type: array
        items:
          "$ref": "#/definitions/Mihari_Entities_Tag"
    required:
      - total
      - currentPage
      - pageSize
      - results
    description: Mihari_Entities_TagsWithPagination model
